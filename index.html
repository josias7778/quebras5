<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Registro por Voz - Individual</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }
    .campo {
      margin-bottom: 12px;
    }
    .label {
      display: inline-block;
      width: 180px;
      font-weight: bold;
    }
    .valor {
      display: inline-block;
      min-width: 200px;
      padding: 6px;
      background-color: #f2f2f2;
      border-radius: 4px;
    }
    button {
      margin-left: 10px;
    }
    #status {
      margin-top: 20px;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <h1>Registro por Voz</h1>

  <div class="campo">
    <span class="label">Linha:</span>
    <span id="linha" class="valor"></span>
    <button onclick="startRecognition('linha')">ğŸ¤ Falar</button>
  </div>

  <div class="campo">
    <span class="label">CÃ³digo da PeÃ§a:</span>
    <span id="codigo" class="valor"></span>
    <button onclick="startRecognition('codigo')">ğŸ¤ Falar</button>
  </div>

  <div class="campo">
    <span class="label">Tipo da PeÃ§a:</span>
    <span id="tipo" class="valor"></span>
    <button onclick="startRecognition('tipo')">ğŸ¤ Falar</button>
  </div>

  <div class="campo">
    <span class="label">Local de InstalaÃ§Ã£o:</span>
    <span id="local" class="valor"></span>
    <button onclick="startRecognition('local')">ğŸ¤ Falar</button>
  </div>

  <div class="campo">
    <span class="label">ObservaÃ§Ã£o:</span>
    <span id="obs" class="valor"></span>
    <button onclick="startRecognition('obs')">ğŸ¤ Falar</button>
  </div>

  <button onclick="sendData()">ğŸ“¤ Enviar para Planilha</button>

  <div id="status"></div>

  <script>
    let dados = {
      linha: '',
      codigo: '',
      tipo: '',
      local: '',
      obs: ''
    };

    function startRecognition(campo) {
      if (!('webkitSpeechRecognition' in window)) {
        alert('Use o Google Chrome no Android ou PC.');
        return;
      }

      const recognition = new webkitSpeechRecognition();
      recognition.lang = 'pt-BR';
      recognition.continuous = false;
      recognition.interimResults = false;

      document.getElementById('status').innerText = `ğŸ™ï¸ Fale o campo: ${campo}`;

      recognition.onresult = function (event) {
        const texto = event.results[0][0].transcript.trim();
        dados[campo] = texto;
        document.getElementById(campo).innerText = texto;
        document.getElementById('status').innerText = `âœ… ${campo} registrado: ${texto}`;
      };

      recognition.onerror = function (event) {
        document.getElementById('status').innerText = 'âŒ Erro: ' + event.error;
      };

      recognition.start();
    }

    function sendData() {
      const { linha, codigo, tipo, local, obs } = dados;
      if (!linha || !codigo || !tipo || !local) {
        alert('Preencha todos os campos obrigatÃ³rios (linha, cÃ³digo, tipo, local).');
        return;
      }

      const agora = new Date();
      const payload = {
        aba: "Registros",
        linha,
        codigo,
        tipo,
        local,
        obs,
        data: agora.toLocaleDateString('pt-BR'),
        hora: agora.toLocaleTimeString('pt-BR')
      };

      fetch('https://script.google.com/macros/s/AKfycbyNgg2Jfdb50B49ox3ONa-cKc0oiXWTswC79ZgGbk1Eaaynipa_SI6YsjLFA-SQ7CYSBQ/exec', {
        method: 'POST',
        body: JSON.stringify(payload),
        headers: {
          'Content-Type': 'application/json'
        }
      })
        .then(res => res.text())
        .then(txt => {
          document.getElementById('status').innerText = 'âœ… Dados enviados com sucesso!';
          Object.keys(dados).forEach(k => {
            dados[k] = '';
            document.getElementById(k).innerText = '';
          });
        })
        .catch(err => {
          document.getElementById('status').innerText = 'âŒ Erro ao enviar: ' + err;
        });
    }
  </script>
</body>
</html>
